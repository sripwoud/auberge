---
# Dual-user inventory structure
all:
  children:
    # Self-hosting servers
    auberge:
      hosts:
        selfhost-old:
          ansible_host: "{{ lookup('env', 'SELFHOST_OLD_HOST') }}"
          ansible_port: 2209
          bootstrap_user: root
        selfhost:
          ansible_host: "{{ lookup('env', 'SELFHOST_HOST') }}"
          ansible_port: 22 # Will change after bootstrap
          bootstrap_user: root # Adjust if different

    # Vibecoding server
    vibecoding:
      hosts:
        vibecoder:
          ansible_host: "{{ lookup('env', 'VIBECODER_HOST') }}"
          ansible_port: 59865
          bootstrap_user: debian

    # All VPS servers (parent group)
    vps:
      children:
        auberge:
        vibecoding:
      vars:
        # Default to ansible automation user
        ansible_user: ansible
        ansible_ssh_private_key_file: "{{ lookup('env', 'HOME') }}/.ssh/identities/ansible_{{ inventory_hostname }}"

        # Your personal admin user (sourced from group_vars/all/main.yml)
        admin_ssh_private_key_file: "{{ lookup('env', 'HOME') }}/.ssh/identities/{{ admin_user_name }}_{{ inventory_hostname }}"

        # Common SSH settings
        ansible_python_interpreter: /usr/bin/python3
        ansible_ssh_pipelining: true
        ansible_ssh_common_args: >-
          -o ControlMaster=auto
          -o ControlPersist=60s
          -o UserKnownHostsFile={{ lookup('env', 'HOME') }}/.ssh/known_hosts
          -o IdentitiesOnly=yes
          -o PasswordAuthentication=no
          -o StrictHostKeyChecking=yes
